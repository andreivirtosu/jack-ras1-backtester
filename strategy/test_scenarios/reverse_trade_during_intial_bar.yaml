scenarios:
  - desc: "trade reversal during initial bar:  => sell"
    config:
      symbol: "IBM"
      trading_mode:
        type: "Daily"
        value: 1
      dollar_amount: 1000
      base_bar_opp: false
      thresholds:
        base_bar_pct: 10.0
        base_bar_end_pct: 1.0
    bars:
      - { o: 110.0, h: 120.0, l: 100.0, c: 105.0, vol: 100000, is_base_bar: false }
      - { o: 110.0, h: 130.0, l: 110.0, c: 120.0, vol: 100000, is_base_bar: true }
      - { o: 120.0, h: 130.0, l: 108.0, c: 124.0, vol: 100000, is_base_bar: false }
    expected_signals:
      - signal_type: "Buy"
        signal_trigger_price: 120.0
        size: 8
        reason: "first trade"
      - signal_type: "Sell"
        signal_trigger_price: 108.0
        size: 17
        reason: "reverse [on initial-bar]"

  - desc: "trade reversal during initial bar:  => NO: base_bar_pct 108 not reached "
    config:
      symbol: "IBM"
      trading_mode:
        type: "Daily"
        value: 1
      dollar_amount: 1000
      base_bar_opp: false
      thresholds:
        base_bar_pct: 10.0
        base_bar_end_pct: 1.0
    bars:
      - { o: 110.0, h: 120.0, l: 100.0, c: 105.0, vol: 100000, is_base_bar: false }
      - { o: 110.0, h: 130.0, l: 110.0, c: 120.0, vol: 100000, is_base_bar: true }
      - { o: 120.0, h: 130.0, l: 108.5, c: 124.0, vol: 100000, is_base_bar: false }
    expected_signals:
      - signal_type: "Buy"
        signal_trigger_price: 120.0
        size: 8
        reason: "first trade"

  - desc: "trade reversal during initial bar:  => NO: base_bar_end_pct target 108.9 not reached "
    config:
      symbol: "IBM"
      trading_mode:
        type: "Daily"
        value: 1
      dollar_amount: 1000
      base_bar_opp: false
      thresholds:
        base_bar_pct: 10.0
        base_bar_end_pct: 1.0
    bars:
      - { o: 110.0, h: 120.0, l: 100.0, c: 105.0, vol: 100000, is_base_bar: false }
      - { o: 110.0, h: 130.0, l: 110.0, c: 120.0, vol: 100000, is_base_bar: true }
      - { o: 120.0, h: 130.0, l: 109.0, c: 124.0, vol: 100000, is_base_bar: false }
    expected_signals:
      - signal_type: "Buy"
        signal_trigger_price: 120.0
        size: 8
        reason: "first trade"


  - desc: "trade reversal during initial bar:  => buy"
    config:
      symbol: "IBM"
      trading_mode:
        type: "Daily"
        value: 1
      dollar_amount: 1000
      base_bar_opp: false
      thresholds:
        base_bar_pct: 10.0
        base_bar_end_pct: 1.0
    bars:
      - { o: 130.0, h: 140.0, l: 125.0, c: 135.0, vol: 100000, is_base_bar: false }
      - { o: 130.0, h: 135.0, l: 120.0, c: 120.0, vol: 100000, is_base_bar: true }
      - { o: 124.0, h: 137.0, l: 120.0, c: 120.0, vol: 100000, is_base_bar: false }
    expected_signals:
      - signal_type: "Sell"
        signal_trigger_price: 124.0
        size: 8
        reason: "first trade"
      - signal_type: "Buy"
        signal_trigger_price: 136.35
        size: 15
        reason: "reverse [on initial-bar]"


  - desc: "trade reversal during initial bar:  => NO: base_bar_pct target 132 not reached"
    config:
      symbol: "IBM"
      trading_mode:
        type: "Daily"
        value: 1
      dollar_amount: 1000
      base_bar_opp: false
      thresholds:
        base_bar_pct: 10.0
        base_bar_end_pct: 1.0
    bars:
      - { o: 130.0, h: 140.0, l: 125.0, c: 135.0, vol: 100000, is_base_bar: false }
      - { o: 130.0, h: 135.0, l: 120.0, c: 120.0, vol: 100000, is_base_bar: true }
      - { o: 124.0, h: 131.9, l: 120.0, c: 120.0, vol: 100000, is_base_bar: false }
    expected_signals:
      - signal_type: "Sell"
        signal_trigger_price: 124.0
        size: 8
        reason: "first trade"

  - desc: "trade reversal during initial bar:  => NO: base_bar_end_pct target 136.35 not reached"
    config:
      symbol: "IBM"
      trading_mode:
        type: "Daily"
        value: 1
      dollar_amount: 1000
      base_bar_opp: false
      thresholds:
        base_bar_pct: 10.0
        base_bar_end_pct: 1.0
    bars:
      - { o: 130.0, h: 140.0, l: 125.0, c: 135.0, vol: 100000, is_base_bar: false }
      - { o: 130.0, h: 135.0, l: 120.0, c: 120.0, vol: 100000, is_base_bar: true }
      - { o: 124.0, h: 136.1, l: 120.0, c: 120.0, vol: 100000, is_base_bar: false }
    expected_signals:
      - signal_type: "Sell"
        signal_trigger_price: 124.0
        size: 8
        reason: "first trade"

